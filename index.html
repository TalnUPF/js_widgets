<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
  
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqcloud/1.0.4/jqcloud.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqcloud/1.0.4/jqcloud-1.0.4.js"></script>
  
  <!--BRAT-->
  <link rel="stylesheet" type="text/css" href="http://weaver.nlplab.org/~brat/demo/v1.3/style-vis.css"/>
  <link rel="stylesheet" href="https://rawgit.com/TalnUPF/js_widgets/master/css/fix.css">
  <script type="text/javascript" src="http://weaver.nlplab.org/~brat/demo/v1.3/client/lib/head.load.min.js"></script>
  
  <!--GRAPH-->
  <script type="text/javascript" src="https://cdnjs.cat.net/ajax/libs/sigma.js/1.2.1/sigma.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cat.net/ajax/libs/sigma.js/1.2.1/plugins/sigma.layout.forceAtlas2.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cat.net/ajax/libs/sigma.js/1.2.1/plugins/sigma.parsers.gexf.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cat.net/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.edgeLabels.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cat.net/ajax/libs/sigma.js/1.2.1/plugins/sigma.plugins.filter.min.js"></script>
  
  <!--CHART-->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  <link rel="stylesheet" href="https://rawgit.com/TalnUPF/js_widgets/master/external/radar.css">
  <script type="text/javascript" src="https://rawgit.com/TalnUPF/js_widgets/master/external/radarChart.js"></script>
  
  <!--TALN WIDGETS-->
  <script type="text/javascript" src="https://rawgit.com/TalnUPF/js_widgets/master/js/taln.widgets.brat.js"></script>
  <script type="text/javascript" src="https://rawgit.com/TalnUPF/js_widgets/master/js/taln.widgets.intensity.js"></script>
  <script type="text/javascript" src="https://rawgit.com/TalnUPF/js_widgets/master/js/taln.widgets.graph.js"></script>
  <script type="text/javascript" src="https://rawgit.com/TalnUPF/js_widgets/master/js/taln.widgets.chart.js"></script>
  
  <!--TALN DEMO-->
  <link rel="stylesheet" href="https://rawgit.com/TalnUPF/js_widgets/master/css/tensorDemo.css">

  <title>TALN Widgets</title>
</head>

<body>

	<div class="container base pb-5">
	
		<div class="d-inline-block py-4 px-4 mb-4">
			<img src="https://rawgit.com/TalnUPF/js_widgets/master/resources/TALN.png" class="float-right pb-2 logo"/>
  			<span class="header-text">TALN </span><span class="header-text no-wrap">Widgets examples</span>
		</div>
		
		<h3 class="pl-3">Results:</h3>
	
		<div class="card">
			<div class="card-header">
				<ul class="nav nav-tabs nav-fill card-header-tabs" id="myTab" role="tablist">
				  <li class="nav-item">
					<a class="nav-link active" data-toggle="tab" href="#highlight" role="tab" aria-controls="highlight-tab" aria-selected="true">Highlight</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" data-toggle="tab" href="#brat" role="tab" aria-controls="brat-tab" aria-selected="false">Brat</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" data-toggle="tab" href="#graph" role="tab" aria-controls="graph-tab" aria-selected="false">Graph</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" data-toggle="tab" href="#chart" role="tab" aria-controls="chart-tab" aria-selected="false">Chart</a>
				  </li>
				</ul>
		</div>

		<div class="tab-content card-body" id="myTabContent">
			<div class="tab-pane fade show active" id="highlight" role="tabpanel" aria-labelledby="highlight-tab">
			  	<div id="intensityComponent" class="form-control" style="height: 200px;" contenteditable="true"></div>
				<button class="btn btn-primary btn-lg mt-4" id="submitHighlight" data-loading-text="<i class='fa fa-spinner fa-spin'></i> Processing">Analyze</button>
			</div>
	
			<div class="tab-pane fade" id="brat" role="tabpanel" aria-labelledby="brat-tab">
				<button class="btn btn-primary btn-lg mb-4" id="submitBrat" data-loading-text="<i class='fa fa-spinner fa-spin '></i> Processing">Analyze</button>
				<div id="bratContainer">
					<div id="bratComponent"></div>
				</div>
			</div>
		
			<div class="tab-pane fade" id="graph" role="tabpanel" aria-labelledby="graph-tab">
				<button class="btn btn-primary btn-lg mb-4" id="submitGraph" data-loading-text="<i class='fa fa-spinner fa-spin '></i> Processing">Analyze</button>
				
				<div id="graphComponent"></div>
			</div>
		
			<div class="tab-pane fade" id="chart" role="tabpanel" aria-labelledby="chart-tab">
				<button class="btn btn-primary btn-lg mb-4" id="submitChart" data-loading-text="<i class='fa fa-spinner fa-spin '></i> Processing">Analyze</button>
			
				<div id="chartComponent" class="accordion"></div>
			</div>
		</div>
	
	</div>
  

<script type="text/javascript">
/**
 * Base output JavaScript functions
 */
var bratLocation = 'http://weaver.nlplab.org/~brat/demo/v1.3';
head.js(
	//JQuery and Boostrap already loaded in head section

	// External libraries
	'https://rawgit.com/TalnUPF/js_widgets/master/external/jquery.svg.min.js',
    'https://rawgit.com/TalnUPF/js_widgets/master/external/jquery.svgdom.min.js',
	
	// brat helper modules
	bratLocation + '/client/src/configuration.js',
	bratLocation + '/client/src/util.js',
	bratLocation + '/client/src/annotation_log.js',
	bratLocation + '/client/lib/webfont.js',
	
	// brat modules
	bratLocation + '/client/src/dispatcher.js',
	bratLocation + '/client/src/url_monitor.js',
	
	'https://rawgit.com/TalnUPF/js_widgets/master/external/visualizer.js'
);

function spinButton() {
  var button = $("#btnLoad");
  button.data('original-text', button.html());
  button.html(button.data('loading-text'));
}

function unspinButton() {
  var button = $("#btnLoad");
  button.html(button.data('original-text'));
}

var margin = {
    top: 80,
    right: 20,
    bottom: 80,
    left: 20
};

var color = d3.scale.ordinal()
    .range(["#3366cc", "#dc3912", "#FFFF00", "#109618", "#990099", "#0099c6", "#dd4477", "#66aa00", "#8B4513", "#316395"]);

var radarChartOptions = {
    w: 480,
    h: 250,
    margin: margin,
    maxValue: 0,
    levels: 5,
    roundStrokes: false,
    roundGrid: false,
    color: color,
    opacityArea: 0.18,
    labelFactor: 1.20,
    wrapWidth: 200,
    chartHorizontalLocation: 0.4,
    chartVerticalLocation: 0.5,
    legendHorizontalLocation: 0.75,
    legendVerticalLocation: 0,
    titleHorizontalLocation: 0,
    titleVerticalLocation: -0.15,
    labelSize: 9,
    legendSize: 10,
    titleSize: 12
};

var bratData = null;

function receiveUrlResult (url, data, output) {
	$.ajax({
		type: "POST",
		dataType: "json",
		url: url
	})
	.done(function(result) {
		var graphsData = profilinigToChart(result, data);
		paintCharts(graphsData, output, radarChartOptions);
	})
	.fail(function(jqXHR, textStatus, errorThrown) {
		var msg = '';
		if (jqXHR.status === 0) {
		    msg = 'Not connect.\n Verify Network.';
		} else if (jqXHR.status == 404) {
		    msg = 'Requested page not found. [404]';
		} else if (jqXHR.status == 500) {
		    msg = 'Internal Server Error [500].';
		} else if (textStatus === 'parsererror') {
		    msg = 'Requested JSON parse failed.';
		} else if (textStatus === 'timeout') {
		    msg = 'Time out error.';
		} else if (textStatus === 'abort') {
		    msg = 'Ajax request aborted.';
		} else {
		    msg = 'Uncaught Error.\n' + jqXHR.responseText;
		}
		alert(msg);
	})
	.always(function(data) {
	});
};

function submitIntensity(type, url, input, loadingCallback, endLoadingCallback) {
	typeof loadingCallback === 'function' && loadingCallback();
	var jqxhr = $.ajax({
			type: type,
			dataType: "json",
			url: url,
			data: {
				text: input
			} 
		})
		.done(function(result) {
			$("#intensityComponent").empty();
			taln.widgets.intensity.loadIntensity2(result["result"], "intensityComponent");
		})
		.fail(function(jqXHR, textStatus, errorThrown) {
			var msg = '';
			if (jqXHR.status === 0) {
			    msg = 'Not connect.\n Verify Network.';
			} else if (jqXHR.status == 404) {
			    msg = 'Requested page not found. [404]';
			} else if (jqXHR.status == 500) {
			    msg = 'Internal Server Error [500].';
			} else if (textStatus === 'parsererror') {
			    msg = 'Requested JSON parse failed.';
			} else if (textStatus === 'timeout') {
			    msg = 'Time out error.';
			} else if (textStatus === 'abort') {
			    msg = 'Ajax request aborted.';
			} else {
			    msg = 'Uncaught Error.\n' + jqXHR.responseText;
			}
			alert(msg);
		})
		.always(function(data) {
			typeof endLoadingCallback === 'function' && endLoadingCallback();
		});
}

function submitBrat(type, url, input, loadingCallback, endLoadingCallback) {
	typeof loadingCallback === 'function' && loadingCallback();
	var jqxhr = $.ajax({
			type: type,
			dataType: "json",
			url: url,
			data: {
				text: input
			} 
		})
		.done(function(result) {
			$("#bratContainer").empty();
			$("#bratContainer").append("<div id=\"bratComponent\"></div>");
			if ($('#brat').hasClass("show")) {
				taln.widgets.brat.loadBrat(result["brat"], "bratComponent");
			} else {
				bratData = result["brat"];
			}
		})
		.fail(function(jqXHR, textStatus, errorThrown) {
			var msg = '';
			if (jqXHR.status === 0) {
			    msg = 'Not connect.\n Verify Network.';
			} else if (jqXHR.status == 404) {
			    msg = 'Requested page not found. [404]';
			} else if (jqXHR.status == 500) {
			    msg = 'Internal Server Error [500].';
			} else if (textStatus === 'parsererror') {
			    msg = 'Requested JSON parse failed.';
			} else if (textStatus === 'timeout') {
			    msg = 'Time out error.';
			} else if (textStatus === 'abort') {
			    msg = 'Ajax request aborted.';
			} else {
			    msg = 'Uncaught Error.\n' + jqXHR.responseText;
			}
			alert(msg);
		})
		.always(function(data) {
			typeof endLoadingCallback === 'function' && endLoadingCallback();
		});
}

function submitGraph(type, url, input, loadingCallback, endLoadingCallback) {
	typeof loadingCallback === 'function' && loadingCallback();
	var jqxhr = $.ajax({
			type: type,
			dataType: "json",
			url: url,
			data: {
				text: input
			} 
		})
		.done(function(result) {
			$("#graphComponent").empty();
			$("#graphComponent").css({height: '500px'});
			taln.widgets.graph.loadGraph(result["data"]["graph"], "graphComponent");
		})
		.fail(function(jqXHR, textStatus, errorThrown) {
			var msg = '';
			if (jqXHR.status === 0) {
			    msg = 'Not connect.\n Verify Network.';
			} else if (jqXHR.status == 404) {
			    msg = 'Requested page not found. [404]';
			} else if (jqXHR.status == 500) {
			    msg = 'Internal Server Error [500].';
			} else if (textStatus === 'parsererror') {
			    msg = 'Requested JSON parse failed.';
			} else if (textStatus === 'timeout') {
			    msg = 'Time out error.';
			} else if (textStatus === 'abort') {
			    msg = 'Ajax request aborted.';
			} else {
			    msg = 'Uncaught Error.\n' + jqXHR.responseText;
			}
			alert(msg);
		})
		.always(function(data) {
			typeof endLoadingCallback === 'function' && endLoadingCallback();
		});
}

function submitChart(type, url, input, loadingCallback, endLoadingCallback) {
	typeof loadingCallback === 'function' && loadingCallback();
	var jqxhr = $.ajax({
			type: type,
			dataType: "json",
			url: url,
			data: {
				text: input
			} 
		})
		.done(function(result) {
			$("#chartComponent").empty();
			receiveUrlResult("./resources/baseRadar3.json", result["data"]["profiling"], "chartComponent");
		})
		.fail(function(jqXHR, textStatus, errorThrown) {
			var msg = '';
			if (jqXHR.status === 0) {
			    msg = 'Not connect.\n Verify Network.';
			} else if (jqXHR.status == 404) {
			    msg = 'Requested page not found. [404]';
			} else if (jqXHR.status == 500) {
			    msg = 'Internal Server Error [500].';
			} else if (textStatus === 'parsererror') {
			    msg = 'Requested JSON parse failed.';
			} else if (textStatus === 'timeout') {
			    msg = 'Time out error.';
			} else if (textStatus === 'abort') {
			    msg = 'Ajax request aborted.';
			} else {
			    msg = 'Uncaught Error.\n' + jqXHR.responseText;
			}
			alert(msg);
		})
		.always(function(data) {
			typeof endLoadingCallback === 'function' && endLoadingCallback();
		});
}

head.ready(function() {
	$("#submitHighlight").click(function() {
      var inputText = $("#intensityComponent").text();
      submitIntensity("POST", "./resources/resultIntensity.json", inputText, spinButton, unspinButton);
    });
    
    $("#submitBrat").click(function() {
      submitBrat("POST", "./resources/resultBrat.json", "", spinButton, unspinButton);
    });
    
    $("#submitGraph").click(function() {
      submitGraph("POST", "./resources/resultGraph.json", "", spinButton, unspinButton);
    });
    
    $("#submitChart").click(function() {
      submitChart("POST", "./resources/resultChart.json", "", spinButton, unspinButton);
    });
});
</script>
